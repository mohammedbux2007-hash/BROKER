<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mini FX App Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #020617;
      color: #f9fafb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    #app {
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      background: radial-gradient(circle at top, #0f172a 0, #020617 60%);
      padding: 16px;
      display: flex;
      flex-direction: column;
    }

    h1, h2, h3 {
      font-weight: 700;
    }

    .logo {
      font-weight: 900;
      letter-spacing: 0.06em;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .logo span {
      padding: 2px 6px;
      border-radius: 4px;
      background: #ef4444;
      font-size: 0.75rem;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.85rem;
      cursor: pointer;
      background: #22c55e;
      color: #022c22;
      font-weight: 600;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }

    button:active {
      transform: scale(0.97);
      box-shadow: 0 0 0;
    }

    button.secondary {
      background: transparent;
      border: 1px solid #64748b;
      color: #e2e8f0;
    }

    .screen {
      flex: 1;
      display: none;
      flex-direction: column;
      gap: 16px;
    }

    .screen.active {
      display: flex;
    }

    .card {
      background: rgba(15, 23, 42, 0.92);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.15);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .muted {
      color: #9ca3af;
      font-size: 0.8rem;
    }

    .highlight {
      color: #22c55e;
      font-weight: 600;
    }

    .danger {
      color: #f97316;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 10px;
    }

    label {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    input, select {
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1f2937;
      padding: 8px 10px;
      color: #f9fafb;
      font-size: 0.85rem;
      outline: none;
    }

    input:focus, select:focus {
      border-color: #22c55e;
    }

    .balance-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      margin-top: 2px;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-top: 6px;
      margin-bottom: 4px;
    }

    .tab {
      flex: 1;
      text-align: center;
      padding: 6px 0;
      font-size: 0.8rem;
      border-radius: 999px;
      border: 1px solid #1f2937;
      cursor: pointer;
      color: #9ca3af;
    }

    .tab.active {
      background: #22c55e;
      color: #022c22;
      border-color: #22c55e;
      font-weight: 600;
    }

    .symbol-list {
      max-height: 180px;
      overflow-y: auto;
      margin-top: 8px;
      border-radius: 10px;
      border: 1px solid #1f2937;
    }

    .symbol-row {
      display: grid;
      grid-template-columns: 1.3fr 0.9fr 0.9fr 0.5fr;
      font-size: 0.8rem;
      padding: 8px 10px;
      align-items: center;
    }

    .symbol-row:nth-child(odd) {
      background: rgba(15, 23, 42, 0.9);
    }

    .symbol-row:nth-child(even) {
      background: rgba(15, 23, 42, 0.6);
    }

    .symbol-name {
      font-weight: 600;
    }

    .badge {
      font-size: 0.65rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #334155;
      color: #9ca3af;
    }

    .positions-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.75rem;
      margin-top: 6px;
    }

    .positions-table th,
    .positions-table td {
      padding: 4px 2px;
      text-align: right;
      white-space: nowrap;
    }

    .positions-table th:first-child,
    .positions-table td:first-child {
      text-align: left;
    }

    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
    }

    .pill-buy {
      background: rgba(22, 163, 74, 0.15);
      color: #4ade80;
    }

    .pill-sell {
      background: rgba(239, 68, 68, 0.18);
      color: #fca5a5;
    }

    #chart {
      width: 100%;
      height: 160px;
      background: radial-gradient(circle at top, #1e293b 0, #020617 75%);
      border-radius: 12px;
      border: 1px solid #1f2937;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .footer {
      text-align: center;
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: 8px;
    }

    .auth-box {
      margin-top: 40px;
    }

    .error-msg {
      color: #f97316;
      font-size: 0.75rem;
      margin-top: 4px;
    }

    @media (max-height: 640px) {
      .symbol-list {
        max-height: 130px;
      }
    }
  </style>
</head>
<body>
<div id="app">
  <div class="top-bar">
    <div class="logo">
      FXAPP <span>DEMO</span>
    </div>
    <button id="logoutBtn" class="secondary" style="display:none;">Logout</button>
  </div>

  <!-- AUTH SCREEN -->
  <div id="authScreen" class="screen active">
    <div class="card auth-box">
      <div class="card-header">
        <div>
          <h2>Welcome</h2>
          <p class="muted">Demo trading app (no real money, no backend)</p>
        </div>
      </div>

      <div class="input-group" style="margin-top:12px;">
        <label for="usernameInput">Username</label>
        <input id="usernameInput" type="text" placeholder="Enter any username" />
      </div>

      <div class="input-group">
        <label for="currencyInput">Account currency</label>
        <select id="currencyInput">
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
          <option value="ZAR">ZAR</option>
        </select>
      </div>

      <div class="input-group">
        <label for="balanceInput">Starting balance</label>
        <input id="balanceInput" type="number" value="10000" min="100" />
      </div>

      <button id="loginBtn" style="width:100%; margin-top:8px;">Enter Platform</button>
      <div id="authError" class="error-msg" style="display:none;">Please enter a username.</div>

      <p class="footer" style="margin-top:10px;">
        This is a front-end demo only.<br/>
        No execution. No real market access.
      </p>
    </div>
  </div>

  <!-- MAIN TRADING SCREEN -->
  <div id="mainScreen" class="screen">
    <!-- ACCOUNT SUMMARY -->
    <div class="card">
      <div class="card-header">
        <div>
          <h3 id="accountName">Account</h3>
          <p class="muted" id="accountInfo">Demo • 1:500 leverage</p>
        </div>
        <div style="text-align:right;">
          <div class="muted" style="font-size:0.75rem;">Balance</div>
          <div class="highlight" id="balanceDisplay">$10,000.00</div>
        </div>
      </div>

      <div class="balance-row">
        <span class="muted">Equity</span>
        <span id="equityDisplay">$10,000.00</span>
      </div>
      <div class="balance-row">
        <span class="muted">Free margin</span>
        <span id="freeMarginDisplay">$10,000.00</span>
      </div>
      <div class="balance-row">
        <span class="muted">Open P&amp;L</span>
        <span id="pnlDisplay" class="highlight">0.00</span>
      </div>
    </div>

    <!-- MARKET WATCH + CHART -->
    <div class="card">
      <div class="card-header">
        <h3>Market</h3>
        <button id="refreshBtn" class="secondary" style="font-size:0.75rem; padding:4px 10px;">Refresh prices</button>
      </div>

      <div class="tabs">
        <div class="tab active" data-tab="fx">FX</div>
        <div class="tab" data-tab="metals">Metals</div>
        <div class="tab" data-tab="indices">Indices</div>
        <div class="tab" data-tab="crypto">Crypto</div>
      </div>

      <div class="symbol-list" id="symbolList"></div>

      <div style="margin-top:10px;">
        <p class="muted" style="margin-bottom:4px;">
          Chart: <span id="chartSymbolLabel">EURUSD</span>
        </p>
        <div id="chart">
          <canvas id="chartCanvas"></canvas>
        </div>
      </div>
    </div>

    <!-- ORDER ENTRY + POSITIONS -->
    <div class="card">
      <div class="card-header">
        <h3>Trade</h3>
        <span class="muted" id="selectedSymbolLabel">Symbol: EURUSD</span>
      </div>

      <div class="input-group">
        <label for="symbolSelect">Symbol</label>
        <select id="symbolSelect"></select>
      </div>

      <div class="input-group">
        <label for="volumeInput">Volume (lots)</label>
        <input id="volumeInput" type="number" step="0.01" min="0.01" value="0.10" />
      </div>

      <div class="input-group">
        <label>Current price</label>
        <div class="balance-row" style="font-size:0.8rem;">
          <span class="muted">Bid</span>
          <span id="bidDisplay">1.00000</span>
        </div>
        <div class="balance-row" style="font-size:0.8rem;">
          <span class="muted">Ask</span>
          <span id="askDisplay">1.00020</span>
        </div>
      </div>

      <div style="display:flex; gap:8px; margin-top:4px;">
        <button id="buyBtn" style="flex:1; background:#22c55e; color:#022c22;">Buy</button>
        <button id="sellBtn" style="flex:1; background:#ef4444; color:#fef2f2;">Sell</button>
      </div>

      <div id="orderError" class="error-msg" style="display:none;">Not enough free margin for this trade.</div>

      <div style="margin-top:12px;">
        <div class="card-header" style="padding:0; margin-bottom:4px;">
          <h3 style="font-size:0.9rem;">Open positions</h3>
          <span class="muted" id="positionsCount">0 positions</span>
        </div>
        <div style="max-height:140px; overflow-y:auto;">
          <table class="positions-table" id="positionsTable">
            <thead>
              <tr>
                <th>Sym</th>
                <th>Side</th>
                <th>Vol</th>
                <th>Open</th>
                <th>Price</th>
                <th>P&amp;L</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="positionsBody">
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <p class="footer">
      DEMO ONLY • No execution • No licenses • Just UI + local simulation.
    </p>
  </div>
</div>

<script>
  // -----------------------------
  // BASIC STATE
  // -----------------------------
  const state = {
    user: null,
    currency: "USD",
    balance: 10000,
    equity: 10000,
    freeMargin: 10000,
    leverage: 500,
    openPnL: 0,
    positions: [],
    symbols: {
      EURUSD: { type: "fx", price: 1.0850, spread: 0.0002 },
      GBPUSD: { type: "fx", price: 1.2750, spread: 0.00025 },
      USDJPY: { type: "fx", price: 155.20, spread: 0.02 },
      XAUUSD: { type: "metals", price: 2400.0, spread: 0.4 },
      XAGUSD: { type: "metals", price: 28.0, spread: 0.05 },
      US30:   { type: "indices", price: 41000, spread: 8 },
      NAS100: { type: "indices", price: 18000, spread: 5 },
      GER40:  { type: "indices", price: 19000, spread: 5 },
      BTCUSD: { type: "crypto", price: 65000, spread: 30 },
      ETHUSD: { type: "crypto", price: 3000, spread: 3 }
    },
    selectedSymbol: "EURUSD",
    chartData: []
  };

  // -----------------------------
  // ELEMENTS
  // -----------------------------
  const authScreen = document.getElementById("authScreen");
  const mainScreen = document.getElementById("mainScreen");
  const logoutBtn = document.getElementById("logoutBtn");

  const usernameInput = document.getElementById("usernameInput");
  const currencyInput = document.getElementById("currencyInput");
  const balanceInput = document.getElementById("balanceInput");
  const loginBtn = document.getElementById("loginBtn");
  const authError = document.getElementById("authError");

  const accountName = document.getElementById("accountName");
  const accountInfo = document.getElementById("accountInfo");
  const balanceDisplay = document.getElementById("balanceDisplay");
  const equityDisplay = document.getElementById("equityDisplay");
  const freeMarginDisplay = document.getElementById("freeMarginDisplay");
  const pnlDisplay = document.getElementById("pnlDisplay");

  const symbolList = document.getElementById("symbolList");
  const tabs = document.querySelectorAll(".tab");
  const chartSymbolLabel = document.getElementById("chartSymbolLabel");
  const chartCanvas = document.getElementById("chartCanvas");

  const symbolSelect = document.getElementById("symbolSelect");
  const selectedSymbolLabel = document.getElementById("selectedSymbolLabel");
  const bidDisplay = document.getElementById("bidDisplay");
  const askDisplay = document.getElementById("askDisplay");
  const volumeInput = document.getElementById("volumeInput");
  const buyBtn = document.getElementById("buyBtn");
  const sellBtn = document.getElementById("sellBtn");
  const orderError = document.getElementById("orderError");

  const positionsBody = document.getElementById("positionsBody");
  const positionsCount = document.getElementById("positionsCount");

  const refreshBtn = document.getElementById("refreshBtn");

  // -----------------------------
  // HELPERS
  // -----------------------------
  function fmt(value, currency = "USD", decimals = 2) {
    return (currency === "USD" || currency === "EUR" || currency === "ZAR")
      ? new Intl.NumberFormat("en-US", {
          style: "currency",
          currency,
          minimumFractionDigits: decimals,
          maximumFractionDigits: decimals
        }).format(value)
      : value.toFixed(decimals);
  }

  function fmtNum(value, decimals = 2) {
    return Number(value).toFixed(decimals);
  }

  function generateChartData(basePrice) {
    const data = [];
    let price = basePrice;
    for (let i = 0; i < 60; i++) {
      const drift = (Math.random() - 0.5) * 0.002 * basePrice;
      price = price + drift;
      data.push(price);
    }
    return data;
  }

  function drawChart() {
    const canvas = chartCanvas;
    const ctx = canvas.getContext("2d");
    const width = canvas.width = canvas.clientWidth;
    const height = canvas.height = canvas.clientHeight;

    const data = state.chartData;
    if (!data || data.length === 0) return;

    const min = Math.min(...data);
    const max = Math.max(...data);
    const range = max - min || 1;

    ctx.clearRect(0, 0, width, height);

    // grid
    ctx.strokeStyle = "rgba(148, 163, 184, 0.2)";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, height * 0.5);
    ctx.lineTo(width, height * 0.5);
    ctx.stroke();

    // line
    ctx.strokeStyle = "#22c55e";
    ctx.lineWidth = 2;
    ctx.beginPath();
    data.forEach((p, i) => {
      const x = (i / (data.length - 1)) * width;
      const y = height - ((p - min) / range) * height;
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();
  }

  function updateAccountUI() {
    balanceDisplay.textContent = fmt(state.balance, state.currency);
    equityDisplay.textContent = fmt(state.equity, state.currency);
    freeMarginDisplay.textContent = fmt(state.freeMargin, state.currency);

    pnlDisplay.textContent = state.openPnL >= 0
      ? "+" + fmtNum(state.openPnL, 2)
      : fmtNum(state.openPnL, 2);
    pnlDisplay.className = state.openPnL >= 0 ? "highlight" : "danger";
  }

  function calculatePnLAndMargins() {
    let pnl = 0;
    let usedMargin = 0;

    state.positions.forEach(pos => {
      const sym = state.symbols[pos.symbol];
      if (!sym) return;
      const midPrice = sym.price;
      const contractSize = getContractSize(pos.symbol);
      const direction = pos.side === "buy" ? 1 : -1;
      const priceDiff = (midPrice - pos.entryPrice) * direction;
      const positionPnL = priceDiff * contractSize * pos.volume;
      pnl += positionPnL;

      const margin = (sym.price * contractSize * pos.volume) / state.leverage;
      usedMargin += margin;
    });

    state.openPnL = pnl;
    state.equity = state.balance + pnl;
    state.freeMargin = Math.max(state.equity - usedMargin, 0);
  }

  function getContractSize(symbol) {
    // Simple illustrative values
    if (symbol.endsWith("USD") && symbol.length === 6) return 100000; // FX
    if (symbol === "XAUUSD") return 100; // gold
    if (symbol === "XAGUSD") return 5000;
    if (symbol === "US30" || symbol === "NAS100" || symbol === "GER40") return 1;
    if (symbol === "BTCUSD") return 1;
    if (symbol === "ETHUSD") return 10;
    return 100000;
  }

  function updateSymbolPrices(randomize = true) {
    Object.keys(state.symbols).forEach(key => {
      const sym = state.symbols[key];
      if (randomize) {
        const volatilityFactor = sym.type === "indices" || sym.type === "crypto" ? 0.004 : 0.0015;
        const change = (Math.random() - 0.5) * volatilityFactor * sym.price;
        sym.price = Math.max(sym.price + change, 0.00001);
      }
    });
    renderSymbolList(currentTab);
    updateOrderPanel();
    calculatePnLAndMargins();
    updateAccountUI();
    updatePositionsTable();
    // update chart data slightly
    const base = state.symbols[state.selectedSymbol].price;
    state.chartData.push(base);
    if (state.chartData.length > 60) state.chartData.shift();
    drawChart();
  }

  // -----------------------------
  // AUTH / NAVIGATION
  // -----------------------------
  loginBtn.addEventListener("click", () => {
    const username = usernameInput.value.trim();
    if (!username) {
      authError.style.display = "block";
      return;
    }
    authError.style.display = "none";

    const startBalance = parseFloat(balanceInput.value) || 10000;
    state.user = username;
    state.currency = currencyInput.value || "USD";
    state.balance = startBalance;
    state.equity = startBalance;
    state.freeMargin = startBalance;

    accountName.textContent = username + " • Demo";
    accountInfo.textContent = `${state.currency} • 1:${state.leverage} leverage`;
    chartSymbolLabel.textContent = state.selectedSymbol;
    selectedSymbolLabel.textContent = "Symbol: " + state.selectedSymbol;

    authScreen.classList.remove("active");
    mainScreen.classList.add("active");
    logoutBtn.style.display = "inline-flex";

    initSymbolSelect();
    initChart();
    updateSymbolPrices(false);
    updateAccountUI();
  });

  logoutBtn.addEventListener("click", () => {
    state.user = null;
    authScreen.classList.add("active");
    mainScreen.classList.remove("active");
    logoutBtn.style.display = "none";
  });

  // -----------------------------
  // MARKET TABS & SYMBOL LIST
  // -----------------------------
  let currentTab = "fx";

  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      currentTab = tab.dataset.tab;
      renderSymbolList(currentTab);
    });
  });

  function renderSymbolList(tab) {
    symbolList.innerHTML = "";
    const fragment = document.createDocumentFragment();
    Object.entries(state.symbols).forEach(([name, sym]) => {
      if (
        (tab === "fx" && sym.type !== "fx") ||
        (tab === "metals" && sym.type !== "metals") ||
        (tab === "indices" && sym.type !== "indices") ||
        (tab === "crypto" && sym.type !== "crypto")
      ) return;

      const row = document.createElement("div");
      row.className = "symbol-row";
      row.dataset.symbol = name;

      const bid = sym.price - sym.spread / 2;
      const ask = sym.price + sym.spread / 2;

      const nameCell = document.createElement("div");
      nameCell.className = "symbol-name";
      nameCell.textContent = name;

      const bidCell = document.createElement("div");
      bidCell.textContent = fmtNum(bid, sym.type === "fx" ? 5 : 2);

      const askCell = document.createElement("div");
      askCell.textContent = fmtNum(ask, sym.type === "fx" ? 5 : 2);

      const actionCell = document.createElement("div");
      const btn = document.createElement("button");
      btn.textContent = "Select";
      btn.className = "secondary";
      btn.style.padding = "4px 8px";
      btn.style.fontSize = "0.7rem";
      btn.addEventListener("click", () => selectSymbol(name));
      actionCell.appendChild(btn);

      row.appendChild(nameCell);
      row.appendChild(bidCell);
      row.appendChild(askCell);
      row.appendChild(actionCell);

      fragment.appendChild(row);
    });
    symbolList.appendChild(fragment);
  }

  function initSymbolSelect() {
    symbolSelect.innerHTML = "";
    Object.keys(state.symbols).forEach(sym => {
      const opt = document.createElement("option");
      opt.value = sym;
      opt.textContent = sym;
      if (sym === state.selectedSymbol) opt.selected = true;
      symbolSelect.appendChild(opt);
    });

    symbolSelect.addEventListener("change", e => {
      selectSymbol(e.target.value);
    });
  }

  function selectSymbol(symbol) {
    state.selectedSymbol = symbol;
    selectedSymbolLabel.textContent = "Symbol: " + symbol;
    chartSymbolLabel.textContent = symbol;
    initChart();
    updateOrderPanel();
  }

  function updateOrderPanel() {
    const sym = state.symbols[state.selectedSymbol];
    if (!sym) return;
    const bid = sym.price - sym.spread / 2;
    const ask = sym.price + sym.spread / 2;
    bidDisplay.textContent = fmtNum(bid, sym.type === "fx" ? 5 : 2);
    askDisplay.textContent = fmtNum(ask, sym.type === "fx" ? 5 : 2);
  }

  refreshBtn.addEventListener("click", () => {
    updateSymbolPrices(true);
  });

  // auto tick prices
  setInterval(() => {
    if (!state.user) return;
    updateSymbolPrices(true);
  }, 3000);

  // -----------------------------
  // CHART INIT
  // -----------------------------
  function initChart() {
    const base = state.symbols[state.selectedSymbol].price;
    state.chartData = generateChartData(base);
    drawChart();
  }

  window.addEventListener("resize", () => {
    drawChart();
  });

  // -----------------------------
  // ORDERS & POSITIONS
  // -----------------------------
  buyBtn.addEventListener("click", () => placeOrder("buy"));
  sellBtn.addEventListener("click", () => placeOrder("sell"));

  function placeOrder(side) {
    const vol = parseFloat(volumeInput.value);
    if (!vol || vol <= 0) return;

    const sym = state.symbols[state.selectedSymbol];
    if (!sym) return;

    const bid = sym.price - sym.spread / 2;
    const ask = sym.price + sym.spread / 2;
    const entryPrice = side === "buy" ? ask : bid;

    const contractSize = getContractSize(state.selectedSymbol);
    const notional = entryPrice * contractSize * vol;
    const requiredMargin = notional / state.leverage;

    if (requiredMargin > state.freeMargin) {
      orderError.style.display = "block";
      return;
    } else {
      orderError.style.display = "none";
    }

    const pos = {
      id: Date.now().toString() + Math.random().toString(16).slice(2),
      symbol: state.selectedSymbol,
      side,
      volume: vol,
      entryPrice,
      time: new Date().toLocaleTimeString()
    };
    state.positions.push(pos);
    calculatePnLAndMargins();
    updateAccountUI();
    updatePositionsTable();
  }

  function closePosition(id) {
    const index = state.positions.findIndex(p => p.id === id);
    if (index === -1) return;

    const pos = state.positions[index];
    const sym = state.symbols[pos.symbol];
    const midPrice = sym.price;
    const contractSize = getContractSize(pos.symbol);
    const direction = pos.side === "buy" ? 1 : -1;
    const priceDiff = (midPrice - pos.entryPrice) * direction;
    const pnl = priceDiff * contractSize * pos.volume;

    state.balance += pnl;
    state.positions.splice(index, 1);

    calculatePnLAndMargins();
    updateAccountUI();
    updatePositionsTable();
  }

  function updatePositionsTable() {
    positionsBody.innerHTML = "";
    positionsCount.textContent = `${state.positions.length} positions`;

    state.positions.forEach(pos => {
      const sym = state.symbols[pos.symbol];
      const mid = sym.price;
      const contractSize = getContractSize(pos.symbol);
      const direction = pos.side === "buy" ? 1 : -1;
      const priceDiff = (mid - pos.entryPrice) * direction;
      const pnl = priceDiff * contractSize * pos.volume;

      const tr = document.createElement("tr");

      const symTd = document.createElement("td");
      symTd.textContent = pos.symbol;

      const sideTd = document.createElement("td");
      const pill = document.createElement("span");
      pill.className = "pill " + (pos.side === "buy" ? "pill-buy" : "pill-sell");
      pill.textContent = pos.side.toUpperCase();
      sideTd.appendChild(pill);

      const volTd = document.createElement("td");
      volTd.textContent = fmtNum(pos.volume, 2);

      const openTd = document.createElement("td");
      openTd.textContent = fmtNum(pos.entryPrice, sym.type === "fx" ? 5 : 2);

      const priceTd = document.createElement("td");
      priceTd.textContent = fmtNum(mid, sym.type === "fx" ? 5 : 2);

      const pnlTd = document.createElement("td");
      pnlTd.textContent = fmtNum(pnl, 2);
      pnlTd.style.color = pnl >= 0 ? "#4ade80" : "#fb7185";

      const closeTd = document.createElement("td");
      const closeBtn = document.createElement("button");
      closeBtn.textContent = "×";
      closeBtn.className = "secondary";
      closeBtn.style.padding = "2px 6px";
      closeBtn.style.fontSize = "0.7rem";
      closeBtn.addEventListener("click", () => closePosition(pos.id));
      closeTd.appendChild(closeBtn);

      tr.appendChild(symTd);
      tr.appendChild(sideTd);
      tr.appendChild(volTd);
      tr.appendChild(openTd);
      tr.appendChild(priceTd);
      tr.appendChild(pnlTd);
      tr.appendChild(closeTd);

      positionsBody.appendChild(tr);
    });
  }

  // initial symbol list before login (for layout)
  renderSymbolList(currentTab);
</script>
</body>
</html>
