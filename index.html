<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mini FX Broker – Live Candles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <!-- Lightweight Charts (TradingView open-source) -->
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #020617;
      color: #f9fafb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    #app {
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      background: radial-gradient(circle at top, #0f172a 0, #020617 60%);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-weight: 900;
      letter-spacing: 0.08em;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .logo span {
      padding: 2px 6px;
      border-radius: 4px;
      background: #ef4444;
      font-size: 0.7rem;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.8rem;
      cursor: pointer;
      background: #22c55e;
      color: #022c22;
      font-weight: 600;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }

    button:active {
      transform: scale(0.97);
      box-shadow: none;
    }

    button.secondary {
      background: transparent;
      border: 1px solid #64748b;
      color: #e2e8f0;
    }

    .card {
      background: rgba(15, 23, 42, 0.94);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.18);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .muted {
      color: #9ca3af;
      font-size: 0.8rem;
    }

    .highlight {
      color: #22c55e;
      font-weight: 600;
    }

    .danger {
      color: #fb7185;
      font-weight: 600;
    }

    .input-row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    select {
      background: #020617;
      border-radius: 999px;
      border: 1px solid #1f2937;
      padding: 6px 10px;
      color: #f9fafb;
      font-size: 0.8rem;
      outline: none;
    }

    select:focus {
      border-color: #22c55e;
    }

    #chartWrap {
      width: 100%;
      height: 260px;
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: radial-gradient(circle at top, #1e293b 0, #020617 75%);
      margin-top: 8px;
      overflow: hidden;
    }

    #chartContainer {
      width: 100%;
      height: 100%;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      margin-top: 6px;
    }

    .label {
      color: #9ca3af;
    }

    .value {
      font-weight: 600;
    }

    .footer {
      text-align: center;
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: 4px;
    }
  </style>
</head>
<body>
<div id="app">
  <div class="top-bar">
    <div class="logo">
      FXAPP <span>LIVE DEMO</span>
    </div>
    <button class="secondary" id="refreshBtn" style="font-size:0.75rem; padding:4px 10px;">Refresh</button>
  </div>

  <!-- SYMBOL + INTERVAL SELECTION -->
  <div class="card">
    <div class="card-header">
      <div>
        <h3 id="symbolTitle">EUR/USD</h3>
        <p class="muted" id="symbolSubtitle">5 min candles • Live market data (Twelve Data)</p>
      </div>
      <div style="text-align:right;">
        <div class="muted" style="font-size:0.7rem;">Last</div>
        <div id="lastPrice" class="highlight">–</div>
      </div>
    </div>

    <div class="input-row">
      <div>
        <div class="muted" style="font-size:0.7rem; margin-bottom:2px;">Symbol</div>
        <select id="symbolSelect">
          <!-- These are FX/metal symbols supported by Twelve Data -->
          <option value="EUR/USD">EUR/USD</option>
          <option value="GBP/USD">GBP/USD</option>
          <option value="USD/JPY">USD/JPY</option>
          <option value="USD/ZAR">USD/ZAR</option>
          <option value="XAU/USD">XAU/USD</option>
          <option value="XAG/USD">XAG/USD</option>
        </select>
      </div>

      <div>
        <div class="muted" style="font-size:0.7rem; margin-bottom:2px;">Interval</div>
        <select id="intervalSelect">
          <option value="1min">1 min</option>
          <option value="5min" selected>5 min</option>
          <option value="15min">15 min</option>
          <option value="1h">1 hour</option>
          <option value="4h">4 hour</option>
          <option value="1day">1 day</option>
        </select>
      </div>

      <div>
        <div class="muted" style="font-size:0.7rem; margin-bottom:2px;">Bars</div>
        <select id="barsSelect">
          <option value="100">100</option>
          <option value="200" selected>200</option>
          <option value="400">400</option>
        </select>
      </div>
    </div>

    <div id="chartWrap">
      <div id="chartContainer"></div>
    </div>

    <div class="price-row">
      <span class="label">O:</span><span class="value" id="openVal">–</span>
      <span class="label">H:</span><span class="value" id="highVal">–</span>
      <span class="label">L:</span><span class="value" id="lowVal">–</span>
      <span class="label">C:</span><span class="value" id="closeVal">–</span>
    </div>

    <div class="price-row">
      <span class="muted" id="statusText">Waiting for data…</span>
      <span class="muted" style="font-size:0.7rem;">Data: Twelve Data API</span>
    </div>
  </div>

  <!-- SIMPLE "TRADE" SECTION (FAKE, NO BACKEND) -->
  <div class="card">
    <div class="card-header">
      <h3>Quick Trade (Demo)</h3>
      <span class="muted" style="font-size:0.75rem;">No real orders. UI only.</span>
    </div>

    <div class="price-row">
      <span class="label">Current price</span>
      <span class="value" id="tradePrice">–</span>
    </div>

    <div class="input-row" style="margin-top:10px;">
      <div style="flex:1;">
        <div class="muted" style="font-size:0.7rem; margin-bottom:2px;">Volume (lots)</div>
        <select id="volumeSelect" style="width:100%;">
          <option value="0.01">0.01</option>
          <option value="0.10" selected>0.10</option>
          <option value="0.50">0.50</option>
          <option value="1.00">1.00</option>
        </select>
      </div>
      <div style="display:flex; flex:1; gap:6px; align-items:flex-end;">
        <button id="buyBtn" style="flex:1; background:#22c55e; color:#022c22;">Buy</button>
        <button id="sellBtn" style="flex:1; background:#ef4444; color:#fef2f2;">Sell</button>
      </div>
    </div>

    <div class="price-row" style="margin-top:10px;">
      <span class="muted" id="lastAction">No trades yet (demo only).</span>
    </div>
  </div>

  <p class="footer">
    DEMO FRONT-END • Real market data via API • No execution • No licensing<br/>
    To build a real broker (XM/Exness style) you still need backend, LP, regulation, KYC, etc.
  </p>
</div>

<script>
  // -------------------------
  // CONFIG – EDIT THIS PART
  // -------------------------
  // 1. Get a free API key from https://twelvedata.com/ and paste it below.
  const API_KEY = "YOUR_TWELVEDATA_API_KEY_HERE";

  // 2. Base URL for Twelve Data API
  const BASE_URL = "https://api.twelvedata.com";

  // -------------------------
  // DOM ELEMENTS
  // -------------------------
  const symbolSelect = document.getElementById("symbolSelect");
  const intervalSelect = document.getElementById("intervalSelect");
  const barsSelect = document.getElementById("barsSelect");
  const refreshBtn = document.getElementById("refreshBtn");

  const symbolTitle = document.getElementById("symbolTitle");
  const symbolSubtitle = document.getElementById("symbolSubtitle");
  const lastPriceEl = document.getElementById("lastPrice");

  const openVal = document.getElementById("openVal");
  const highVal = document.getElementById("highVal");
  const lowVal = document.getElementById("lowVal");
  const closeVal = document.getElementById("closeVal");
  const statusText = document.getElementById("statusText");

  const tradePriceEl = document.getElementById("tradePrice");
  const volumeSelect = document.getElementById("volumeSelect");
  const buyBtn = document.getElementById("buyBtn");
  const sellBtn = document.getElementById("sellBtn");
  const lastAction = document.getElementById("lastAction");

  const chartContainer = document.getElementById("chartContainer");

  // -------------------------
  // CHART SETUP
  // -------------------------
  let chart, candleSeries;

  function initChart() {
    if (chart) {
      chart.remove();
    }
    chart = LightweightCharts.createChart(chartContainer, {
      layout: {
        background: { color: "transparent" },
        textColor: "#e5e7eb",
      },
      grid: {
        vertLines: { color: "#1f2937" },
        horzLines: { color: "#1f2937" },
      },
      timeScale: {
        timeVisible: true,
        secondsVisible: false,
      },
      rightPriceScale: {
        borderColor: "#1f2937",
      },
      crosshair: {
        mode: LightweightCharts.CrosshairMode.Normal,
      },
      width: chartContainer.clientWidth,
      height: chartContainer.clientHeight,
    });

    candleSeries = chart.addCandlestickSeries({
      upColor: "#22c55e",
      downColor: "#ef4444",
      borderVisible: false,
      wickUpColor: "#22c55e",
      wickDownColor: "#ef4444",
    });

    window.addEventListener("resize", () => {
      chart.applyOptions({
        width: chartContainer.clientWidth,
        height: chartContainer.clientHeight,
      });
    });
  }

  // -------------------------
  // DATA FETCHING
  // -------------------------
  async function fetchCandles(symbol, interval, bars) {
    if (!API_KEY || API_KEY === "YOUR_TWELVEDATA_API_KEY_HERE") {
      statusText.textContent = "Set your Twelve Data API key in the script.";
      statusText.className = "muted danger";
      return null;
    }

    statusText.textContent = "Loading candles…";
    statusText.className = "muted";

    const url = `${BASE_URL}/time_series?symbol=${encodeURIComponent(symbol)}&interval=${interval}&outputsize=${bars}&apikey=${API_KEY}`;
    try {
      const res = await fetch(url);
      const data = await res.json();

      if (data.status === "error") {
        statusText.textContent = data.message || "API error.";
        statusText.className = "muted danger";
        console.error("API error:", data);
        return null;
      }

      if (!data.values || !Array.isArray(data.values)) {
        statusText.textContent = "No data returned.";
        statusText.className = "muted danger";
        console.error("Unexpected response:", data);
        return null;
      }

      // values are typically sorted newest -> oldest, so reverse
      const values = [...data.values].reverse();

      const candles = values.map(v => ({
        time: Math.floor(new Date(v.datetime).getTime() / 1000),
        open: parseFloat(v.open),
        high: parseFloat(v.high),
        low: parseFloat(v.low),
        close: parseFloat(v.close),
      }));

      statusText.textContent = `Loaded ${candles.length} bars • ${symbol} • ${interval}`;
      statusText.className = "muted";

      return {
        candles,
        last: candles[candles.length - 1] || null,
      };
    } catch (err) {
      console.error(err);
      statusText.textContent = "Network or CORS error fetching data.";
      statusText.className = "muted danger";
      return null;
    }
  }

  // -------------------------
  // UPDATE UI FROM DATA
  // -------------------------
  async function loadChartAndPrices() {
    const symbol = symbolSelect.value;
    const interval = intervalSelect.value;
    const bars = barsSelect.value;

    symbolTitle.textContent = symbol;
    symbolSubtitle.textContent = `${interval} candles • Live FX market (via API)`;

    const result = await fetchCandles(symbol, interval, bars);
    if (!result || !result.candles || result.candles.length === 0) {
      return;
    }

    candleSeries.setData(result.candles);

    const last = result.last;
    if (last) {
      const o = last.open;
      const h = last.high;
      const l = last.low;
      const c = last.close;

      openVal.textContent = o.toFixed(5);
      highVal.textContent = h.toFixed(5);
      lowVal.textContent = l.toFixed(5);
      closeVal.textContent = c.toFixed(5);

      lastPriceEl.textContent = c.toFixed(5);
      tradePriceEl.textContent = c.toFixed(5);
    }
  }

  // -------------------------
  // DEMO "TRADING" BUTTONS
  // -------------------------
  function registerTradeButtons() {
    buyBtn.addEventListener("click", () => {
      const symbol = symbolSelect.value;
      const vol = volumeSelect.value;
      const price = tradePriceEl.textContent || "–";
      lastAction.textContent = `Demo BUY ${vol} lots of ${symbol} @ ${price}`;
    });

    sellBtn.addEventListener("click", () => {
      const symbol = symbolSelect.value;
      const vol = volumeSelect.value;
      const price = tradePriceEl.textContent || "–";
      lastAction.textContent = `Demo SELL ${vol} lots of ${symbol} @ ${price}`;
    });
  }

  // -------------------------
  // EVENT WIRING
  // -------------------------
  symbolSelect.addEventListener("change", loadChartAndPrices);
  intervalSelect.addEventListener("change", loadChartAndPrices);
  barsSelect.addEventListener("change", loadChartAndPrices);
  refreshBtn.addEventListener("click", loadChartAndPrices);

  // -------------------------
  // INIT
  // -------------------------
  initChart();
  registerTradeButtons();
  loadChartAndPrices();

  // Optional: refresh every 30s for a "live" feel (respect rate limits)
  setInterval(loadChartAndPrices, 30000);
</script>
</body>
</html>
